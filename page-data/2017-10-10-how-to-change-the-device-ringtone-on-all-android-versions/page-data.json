{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/","result":{"data":{"post":{"__typename":"MdxPost","slug":"/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/","title":"How To Change The Device Ringtone On All Android Versions","date":"10.10.2017","tags":[{"name":"android","slug":"android"},{"name":"audio","slug":"audio"}],"description":null,"canonicalUrl":"https://elvischidera.com/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How To Change The Device Ringtone On All Android Versions\",\n  \"date\": \"2017-10-10T00:00:00.000Z\",\n  \"slug\": \"/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/\",\n  \"canonicalUrl\": \"https://elvischidera.com/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/\",\n  \"banner\": \"./assets/banner.jpeg\",\n  \"tags\": [\"android\", \"audio\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Recent versions of Android come with wonderful features and some (good) restrictions. One of this restriction is the run-time permission that was added in Android Marshmallow. Before Android Marshmallow, permissions were granted at install time rather than at run-time.\"), mdx(\"p\", null, \"While run-time permissions are pretty straightforward to work with, performing some (special) actions require some extra work on the developer and the user path. Example of such special actions is changing the device ringtone or drawing over other apps (like Facebook messenger chat heads).\"), mdx(\"p\", null, \"You will have to take the user out of your app to the settings app for them to be able to enable the permission needed and then they have to go back to your app to continue what they were trying to do.\"), mdx(\"p\", null, \"If all you just want to do is change the device ringtone, this might be too much work for you to do. I created a helper class you can use to easily change the ringtone on a device. It does all the version checking and the special permission handling for you and you can easily extend it to serve your use case.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/9920e49baf95ab545282f25da5cece95/87945/banner.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"62.5%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEAv/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABeCjImESf/8QAGxAAAwACAwAAAAAAAAAAAAAAAAECAxESEzL/2gAIAQEAAQUCnLs7DkyWpiEjJ7//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAwEBPwGH/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERElH/2gAIAQIBAT8Bh6WZ/8QAGBAAAwEBAAAAAAAAAAAAAAAAABExARD/2gAIAQEABj8CIQSvNP/EABwQAQACAgMBAAAAAAAAAAAAAAEAIRExEEFRkf/aAAgBAQABPyFyV1cGl3zENn7MQarZhHnE/9oADAMBAAIAAwAAABA7D//EABcRAQEBAQAAAAAAAAAAAAAAAAEAEVH/2gAIAQMBAT8QF21v/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAECAQE/EDeCG3//xAAaEAEAAwEBAQAAAAAAAAAAAAABABEhMRBh/9oACAEBAAE/EA1Ci5rSdeCjWWfI8UlL2SAl33UdiiRQqC4X5v/Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"banner\",\n    \"title\": \"banner\",\n    \"src\": \"/static/9920e49baf95ab545282f25da5cece95/18e3b/banner.jpg\",\n    \"srcSet\": [\"/static/9920e49baf95ab545282f25da5cece95/46946/banner.jpg 240w\", \"/static/9920e49baf95ab545282f25da5cece95/55489/banner.jpg 480w\", \"/static/9920e49baf95ab545282f25da5cece95/18e3b/banner.jpg 960w\", \"/static/9920e49baf95ab545282f25da5cece95/87945/banner.jpg 1024w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Before using the class, ensure you have the required WRITE_SETTINGS permission in your AndroidManifest.xml file\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-xml:title=AndroidManifest.xml\"\n  }), \"<manifest xmlns:android=\\\"http://schemas.android.com/apk/res/android\\\">\\n\\n    <uses-permission android:name=\\\"android.permission.WRITE_SETTINGS\\\" />\\n\\n</manifest>\\n\")), mdx(\"p\", null, \"The helper class (RingtoneUtils) has a setRingtone method that does all the work for you, just pass in a context and the URI of the ringtone you want to change to. Here is the helper class:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=RingtoneUtils.java\"\n  }), \"import android.content.ContentUris;\\nimport android.content.Context;\\nimport android.content.Intent;\\nimport android.media.RingtoneManager;\\nimport android.net.Uri;\\nimport android.os.Build;\\nimport android.provider.MediaStore;\\nimport android.provider.Settings;\\nimport android.support.annotation.NonNull;\\nimport android.support.annotation.RequiresApi;\\nimport android.util.Log;\\nimport android.widget.Toast;\\n\\npublic class RingtoneUtils {\\n\\n    private static final String LOG_TAG = \\\"RingtoneUtils\\\";\\n\\n    public static boolean setRingtone(@NonNull Context context, @NonNull Uri ringtoneUri) {\\n        Log.v(LOG_TAG, \\\"Setting Ringtone to: \\\" + ringtoneUri);\\n\\n        if (!hasMarshmallow()) {\\n            Log.v(LOG_TAG, \\\"On a Lollipop or below device, so go ahead and change device ringtone\\\");\\n            setActualRingtone(context, ringtoneUri);\\n            return true;\\n        }\\n        else if(hasMarshmallow() && canEditSystemSettings(context)) {\\n            Log.v(LOG_TAG, \\\"On a marshmallow or above device but app has the permission to edit system settings\\\");\\n            setActualRingtone(context, ringtoneUri);\\n            return true;\\n        }\\n        else if(hasMarshmallow() && !canEditSystemSettings(context)) {\\n            Log.d(LOG_TAG, \\\"On android Marshmallow and above but app does not have permission to\\\" +\\n                    \\\" edit system settings. Opening the manage write settings activity...\\\");\\n            startManageWriteSettingsActivity(context);\\n            Toast.makeText(context, \\\"Please allow app to edit settings so your ringtone can be updated\\\", Toast.LENGTH_LONG).show();\\n            return false;\\n        }\\n\\n        return false;\\n    }\\n\\n    private static void setActualRingtone(@NonNull Context context, @NonNull Uri ringtoneUri) {\\n        RingtoneManager.setActualDefaultRingtoneUri(context, RingtoneManager.TYPE_RINGTONE, ringtoneUri);\\n    }\\n\\n    @RequiresApi(api = Build.VERSION_CODES.M)\\n    private static void startManageWriteSettingsActivity(@NonNull Context context) {\\n        Intent intent = new Intent(Settings.ACTION_MANAGE_WRITE_SETTINGS);\\n        // Passing in the app package here allows the settings app to open the exact app\\n        intent.setData(Uri.parse(\\\"package:\\\" + context.getApplicationContext().getPackageName()));\\n        // Optional. If you pass in a service context without setting this flag, you will get an exception\\n        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\\n        context.startActivity(intent);\\n    }\\n\\n    private static boolean hasMarshmallow() {\\n        // returns true if the device is Android Marshmallow or above, false otherwise\\n        return Build.VERSION.SDK_INT >= Build.VERSION_CODES.M;\\n    }\\n\\n    @RequiresApi(api = Build.VERSION_CODES.M)\\n    private static boolean canEditSystemSettings(@NonNull Context context) {\\n        // returns true if the app can edit system settings, false otherwise\\n        return Settings.System.canWrite(context.getApplicationContext());\\n    }\\n\\n}\\n\")), mdx(\"p\", null, \"Here is an example of the RingtoneUtils being used to change the device ringtone:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-java:title=ExampleUsage.java\"\n  }), \"import android.content.Context;\\nimport android.database.Cursor;\\nimport android.net.Uri;\\nimport android.provider.MediaStore;\\nimport android.support.annotation.NonNull;\\n    \\npublic class ExampleUsage {\\n    \\n    public void setFirstSongOnDeviceAsRingtone(@NonNull Context context) {\\n        Uri mediaContentUri = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;\\n        String[] projection = new String[] { MediaStore.Audio.Media._ID, MediaStore.Audio.Media.DATA};\\n    \\n        Cursor mediaCursor = context.getContentResolver().query(mediaContentUri, projection, null, null, null);\\n    \\n        if(mediaCursor != null) {\\n            if(mediaCursor.getCount() >= 0) {\\n                // Move to first song item\\n                mediaCursor.moveToPosition(0);\\n                long songId = mediaCursor.getLong(mediaCursor.getColumnIndex(MediaStore.Audio.Media._ID));\\n                String songUri = mediaCursor.getString(mediaCursor.getColumnIndex(MediaStore.Audio.Media.DATA));\\n                Uri songContentUri = MediaStore.Audio.Media.getContentUriForPath(songUri);\\n                Uri ringtoneUri = ContentUris.withAppendedId(songContentUri, songId);\\n    \\n                // Use class to change Ringtone\\n                RingtoneUtils.setRingtone(context, ringtoneUri);\\n            }\\n    \\n            mediaCursor.close();\\n        }\\n    }\\n    \\n}\\n\")), mdx(\"p\", null, \"The steps are similar if you want to have your app draw over other apps, but this post is more focused on changing the device ringtone.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Recent versions of Android come with wonderful features and some (good) restrictions. One of this restriction is the run-time permissionâ€¦","timeToRead":1,"banner":{"childImageSharp":{"resize":{"src":"/static/9920e49baf95ab545282f25da5cece95/a6c62/banner.jpg"}}}}},"pageContext":{"slug":"/2017-10-10-how-to-change-the-device-ringtone-on-all-android-versions/","formatString":"DD.MM.YYYY"}},"staticQueryHashes":["3090400250","3090400250","318001574"]}